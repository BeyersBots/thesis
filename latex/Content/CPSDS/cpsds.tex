\documentclass[12pt,letterpaper,oneside]{book}
\usepackage{../../afitStyleFiles/afitThesis}
\usepackage[nolist]{acronym}
\usepackage{todo}
\usepackage{tabu}
\usepackage{makecell}
\usepackage{enumitem}
\renewcommand\theadfont{\bfseries}
\graphicspath{{../../Figures/}}
\input{../Preamble/myFigures}
\input{../Preamble/myTables}
\input{../Preamble/titlePage}
\usepackage[outdir=./]{epstopdf}
\setcounter{secnumdepth}{0}
\begin{document}
	\begin{acronym}
		\acro {BLE} {Bluetooth Low Energy}
		\acro {SIG} {Special Interest Group}
		\acro {BR/EDR} {Basic Rate/Enhanced Data Rate}
		\acro {IoT} {Internet of Things}
		\acro {COTS} {commercial-off-the-shelf}
		\acro {CI} {critical infrastructure}
		\acro {WSN} {Wireless Sensor Network}
		\acro {ATT} {Attribute Protocol}
		\acro {GATT} {Generic Attribute Profile}
		\acro {SM} {Security Manager}
		\acro {LTK} {Long Term Key}
		\acro {CSRK} {Connection Signature Resolving Key}
		\acro {IRK} {Identity Resolving Key}
		\acro {AES} {Advanced Encryption Standard}
		\acro {TK} {Temporary Key}
		\acro {STK} {Short-Term Key}
		\acro {ECDH} {Elliptic Curve Diffie Hellman}
		\acro {CE} {Connection Events}
		\acro {CRC} {Cyclic Redundancy Check}
		\acro {SCA} {sleep clock accuracy}
		\acro {RSSI} {Received Signal Strength Indicator}
		\acro {MAC} {Media Access Control}
		\acro {CRM} {Customer Relationship Management}
		\acro {BSSID} {basic service set identifier}
		\acro {SSID} {service set identifier}
		\acro {AP} {access point}
		\acro {CSV} {comma-separated values}
		\acro {API} {application programming interface}
		\acro {MPDU} {MAC Protocol Data Unit}
		\acro {FSize} {frame size}
		\acro {CITIoT} {Classification, Identification, Tracking of IoT}
		\acro {WPA2-PSK} {Wi-Fi Protected Access 2 - Pre-Shared Key}
	\end{acronym}
\mainmatter
\section{CITIoT: Data Leakage in Home Automation Systems}
In recent years, smart home devices have become one of the most popular categories in the \ac{IoT} accounting for \$3.5 billion of a \$292 billion industry; over 29 million smart home devices are expected to ship in 2017, a 63 percent increase over 2016 \cite{consumerTech}. Wi-Fi and \ac{BLE} are two of the primary protocols used in these devices and are commonly implemented in security cameras, locks, medical devices, sensors, and a myriad of other devices. With the increasing prevalence of \ac{BLE} and Wi-Fi devices in the home, consumers must be aware of the information these devices inadvertently broadcast and what kind of privacy data an outside observer can infer. 

To stress this threat and the need for secure smart home development, we provide the following scenario: a user is in a smart home connected to a Wi-Fi \ac{AP} and interacts with various Wi-Fi and \ac{BLE} \ac{IoT} devices. In the morning, the user turns on lights, activates sensors while walking throughout the house, and eventually turns off the lights before leaving the house for work (the door is locked before leaving). While at work, the user checks on the temperature in the house or other devices (e.g., security cameras) remotely. After work, the user returns home, unlocks the front door, turns on lights, and activates sensors throughout the house. Before going to bed, the lights are turned off. During the day, an observer is outside the house sniffing wireless data packets attempting to infer information about the user, devices, and events within the house. The observation process is completely passive and, therefore, undetectable by the user. The eavesdropper has no access to  network credentials and is not part of the smart home network. 

This work contributes to the field of \ac{IoT} security, specifically privacy within a smart home, by illustrating how devices leak data and demonstrating how users can prevent leakage. In doing so, we make four principal contributions:

\textbf{Smart home architecture}. To analyze \ac{IoT} data leakage in the wild, we provide a realistic smart home architecture that integrates Wi-Fi and \ac{BLE} \ac{COTS} devices with Apple's home automation application, HomeKit. Examples of interactions with the smart home environment include turning on lights, opening doors, activating motion sensors, and unlocking locks. These interactions occur while the user is home or away.

\textbf{Vulnerability analysis.} We explain how an eavesdropper can use device vulnerabilities to extract information while outside the smart home environment via raw signals sniffed over the air.  These, combined with characteristic data exchanges and packet sizes, can be used to fingerprint components of the smart home environment.

\textbf{\ac{CITIoT}.} We present a tool that demonstrates four capabilities enabled by data leakage: network mapping, device classification, event identification, and user tracking. For Wi-Fi, a fingerprinting technique is applied to classify smart home devices into one of three groups: sensor, electrical outlet, or camera. For \ac{BLE} devices, we similarly classify devices, but provide more descriptive information. The fingerprint technique is also applied to identify events within the smart home such as turning on a light or movement in the house. Lastly, the observed smart home traffic is used to predict when users will be in the smart home.

\textbf{Synthesis.} We stress the importance of smart home operational security by demonstrating how an observer can use the information gathered from smart home devices to create pattern-of-life models, crack a \ac{BLE} lock, and gain access to the home when a user is predicted to be away. We observe that these vulnerabilities are not unique to the devices under study, but indicative of \ac{IoT} design and can be extended to \ac{CI} technologies or any smart environment. We also provide methods to prevent data leakage and defend against the vulnerabilities presented.

The remainder of this paper introduces the reader to the smart home architecture created to provide real-world data to \ac{CITIoT}, the methodology in creating the \ac{CITIoT} tool, and an analysis of results.

\section{Smart Home Architecture}
As shown in Figure~\ref{fig:SmartHomeArchitecture}, the smart home architecture includes three controller components and various connected devices. The controller components include (i) a Raspberry Pi running the Homebridge server that emulates the iOS HomeKit API and exposes supported devices to Apple's HomeKit, (ii) an iPhone 6+ running Apple's HomeKit and device specific applications, and (iii) an Apple TV Generation 2 acting as a smart home hub to allow access to HomeKit supported devices while the user is away from the smart home. The communication between controllers and devices can be observed in Figure~\ref{fig:SmartHomeArchitecture} and is described in the rest of this section.

\figSmartHomeArchitecture

\subsection{Raspberry Pi}

The Raspberry Pi 3 Model B with Raspbian Jessie Lite version 4.9 operating system is connected to the smart home network via the on-board 802.11 b/g/n 2.4 GHz wireless chip \cite{rasbperry}. The Raspberry Pi runs Homebridge version 0.4.14 as a systemd service, and each interaction between a controller and device is logged in the systemd journal \cite{homebridge}. A Homebridge module is utilized to expose Belkin devices to Apple's Homekit and is loaded into Homebridge \cite{wemo}. The Apple devices communicate with the Raspberry Pi to interact with the Wi-Fi devices (devices w$ _2 $-w$ _9 $ in Table~\ref{tbl:WifiDevices}).

\subsection{Apple Devices}

The iPhone 6+ and Apple TV act as controllers in the smart home architecture and connect to devices via Wi-Fi and \ac{BLE}. When the user is home, the iPhone connects to Wi-Fi devices via the Homebridge and directly to the \ac{BLE} devices. Some of the \ac{BLE} devices are not supported by Apple's Homekit and can only be accessed through the manufacturer-provided iOS application on the iPhone (devices b$ _7 $-b$ _{12} $ in Table~\ref{tbl:BtleDevices}). When the user is away from the smart home, the iPhone can communicate with Homekit-supported devices via the iCloud and Apple TV acting as a hub. For example, if the user is away from home and wants to access the temperature in a room, the iPhone communicates with the Apple TV via the iCloud and the Apple TV will communicate with the device in the home via Wi-Fi or \ac{BLE}. This will only work with Homekit supported devices, therefore, \ac{BLE} devices b$ _7 $-b$ _{12} $ cannot be accessed while the user is away from the home. 

\subsection{Wi-Fi Devices}

To facilitate Wi-Fi communication in the smart home architecture, a 2.4 GHz Wi-Fi \ac{AP}, ``Prancing Pony", was setup with \ac{WPA2-PSK} security on channel 1. A list of devices connected to the \ac{AP} can be found in Table~\ref{tbl:WifiDevices}. The smart home devices include a camera, six outlets (four smart plugs, one mini plug, and one energy plug), and a motion sensor (w$ _2 $-w$ _9 $). These devices use the Homebridge to communicate with Apple's HomeKit on the iPhone. 

\tableWifiDevices

\subsection{\acf{BLE} Devices}

For \ac{BLE} communication to occur in the smart home architecture a \ac{BLE} master must be present. In the smart home architecture, the iPhone and Apple TV act as masters while each of the \ac{BLE} devices are slaves. A list of devices operating in the \ac{BLE} can be found in Table~\ref{tbl:BtleDevices}. The \ac{MAC} addresses for each device are not included because they are randomized per the \ac{BLE} protocol \cite{sig4.2}.

\tableBtleDevices

\section{\acf{CITIoT} Tool}

CITIoT operates in five-steps: (i) reconnaissance and scanning, (ii) passive sniffing, (iii) device classification, (iv) event identification, and (v) user tracking. During reconnaissance and scanning, the observer identifies the target, obtains the target's \ac{MAC} address, identifies the target's home network, and scans the network creating a network map of the Wi-Fi devices. In passive sniffing, the obsever sniffs \ac{BLE} and Wi-Fi wireless traffic throughout the day and parses the capture file for values of interest. Next, the captures are sent to \ac{CITIoT} and the smart home devices are classifed as an outlet, sensor, or camera. After the devices are classified, the captures are parsed again and all device events are identified. Lastly, the tool utilizes the Wi-Fi \ac{MAC} address to determine when a user is in the home or away. 

\section{Results}

\ac{CITIoT} was evaluated while a user interacted with the smart home environment ten hours a day for five days. During experimentation, devices are accessed while the user is both home and away to observe differences in communication. The user interacted with devices while home in the morning and evening, and while away in the afternoon. During the interactions, the user logged the time, device, and type of each event. Each device was activated twice in the morning, twice in the evening, and a few times throughout the day for a total of more than twenty activations per device per day. An analysis of the accuracy of \ac{CITIoT} is presented through the comparison of device classification with actual device types, event identification with the logs of actual event times, and user tracking with actual user locations. Preliminary results show that, on average, the device classification was 95\% successful, event identification was 84\% successful, and user tracking was 100\% successful in determining if the user was in the home or not. On average, the tool failed to identify 16\% of events and identified 5 events per day that did not actually occur.

\begin{flushleft}
	\singlespace
	\bibliographystyle{plain}
	\bibliography{../Back/myReferences} 
	\clearpage
\end{flushleft}
\end{document}

